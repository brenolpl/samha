<mat-toolbar class="sub-toolbar">
  <div class="d-flex justify-content-end w-100">
    <button mat-button (click)="goToLog()" class="sub-toolbar-button">
      <mat-icon>history</mat-icon>
      Log de Alterações
    </button>
  </div>
</mat-toolbar>

<mat-card class="margem mb-5 col-md-12 col-sm-6 d-flex base-block" style="overflow: hidden;">

  <mat-card-content class="d-inline-block w-25">
    <mat-card-subtitle>Alocações</mat-card-subtitle>
    <form [formGroup]="formGroup">
      <samha-autocomplete-field
        [resource]="'curso'"
        [label]="'Curso'"
        [control]="cursoControl"
        (onChange)="onCursoChange($event)"
        (loaded)="onCursoLoaded($event)"></samha-autocomplete-field>

      <mat-form-field appearance="outline" class="d-block">
        <mat-label>Turno</mat-label>
        <mat-select formControlName="turno" [compareWith]="compareFunction" (selectionChange)="onTurnoChange()">
          <mat-option [value]="'Matutino'">Matutino</mat-option>
          <mat-option [value]="'Vespertino'">Vespertino</mat-option>
          <mat-option [value]="'Noturno'">Noturno</mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field class="d-block" appearance="outline">
        <mat-label>Turma</mat-label>
        <input type="text" matInput [formControl]="turmaControl" [matAutocomplete]="auto">
        <mat-autocomplete
          (optionSelected)="onTurmaChange()"
          autoActiveFirstOption #auto="matAutocomplete"
          [displayWith]="displayFn">
          <mat-option *ngFor="let option of filteredOptions | async" [value]="option">
            {{option.nome}}
          </mat-option>
        </mat-autocomplete>
      </mat-form-field>

      <div class="d-block">
        <mat-form-field appearance="outline" class="d-inline-block w-75">
          <mat-label>Ano</mat-label>
          <input matInput type="number" formControlName="ano" (change)="onAnoChange()">
        </mat-form-field>

        <mat-form-field appearance="outline" class="d-inline-block w-25">
          <mat-label>Semestre</mat-label>
          <input matInput type="number" [min]="1" [max]="2" formControlName="semestre" (change)="onAnoChange()">
        </mat-form-field>
      </div>

      <mat-form-field appearance="outline" class="d-block">
        <mat-label>Período</mat-label>
        <input matInput type="number" [min]="1" [max]="qtPeriodos" formControlName="periodo" (change)="onAnoChange()">
      </mat-form-field>
    </form>

    <div class="drag-border horizontal-box" style="height: 59px !important;"
         *ngFor="let alocacao of alocacoes"
          draggable="true"
         (dragstart)="onListDraggerStart(alocacao)"
         (dragend)="onDragEnd($event)">
      {{alocacao.disciplina.sigla + ' - ' + getNomeEncurtadoProfessor(alocacao.professor1.nome) + ' ' + getNomeEncurtadoProfessor(alocacao.professor2?.nome)}}
    </div>

    <ng-container *ngIf="!turmaControl.value">
      <span>Nenhuma turma encontrada!</span>
    </ng-container>

    <ng-container *ngIf="!(alocacoes.length > 0) && this.turmaControl.value">
      <span>Nenhuma alocação encontrada!</span>
    </ng-container>

  </mat-card-content>

  <div class="divider d-inline-block"></div>

  <mat-card-content class="d-block" style="width: 50%; min-width: 30%;">
    <mat-card-subtitle>Grade de Horários</mat-card-subtitle>
    <samha-oferta-grid [matriz]="matriz" (aulaIndexChanged)="onAulaIndexChanged($event)" (novaAulaCreated)="onAulaChanged($event)" [novaAula]="novaAula" [turno]="formGroup.get('turno').value"></samha-oferta-grid>

  </mat-card-content>
  <div class="divider d-inline-block"></div>

  <mat-card-content class="d-block" style="width: 20%">
    <mat-card-subtitle>Notificações</mat-card-subtitle>
  </mat-card-content>

</mat-card>


<ng-template #loading>
  <div class="loading-spinner">
    <mat-spinner></mat-spinner>
  </div>
</ng-template>
